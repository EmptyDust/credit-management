# 测试脚本说明

本目录包含了学分管理系统的完整测试脚本，用于测试各个微服务的API接口功能。

## 测试脚本列表

### 1. 认证服务测试
- **文件**: `test-auth-service.ps1`
- **功能**: 测试用户登录、注册、令牌验证、刷新、登出等功能
- **测试项目**: 
  - 用户注册
  - 用户登录
  - 令牌验证
  - 令牌刷新
  - 错误密码登录
  - 不存在用户登录
  - 用户登出
  - 登出后令牌验证

### 2. 用户管理服务测试
- **文件**: `test-user-management-service.ps1`
- **功能**: 测试用户管理相关的所有功能
- **测试项目**:
  - 用户注册
  - 用户登录
  - 获取用户统计信息
  - 获取/更新用户个人资料
  - 获取所有用户列表
  - 按用户类型获取用户列表
  - 获取/更新/删除特定用户信息

### 3. 学生信息服务测试
- **文件**: `test-student-info-service.ps1`
- **功能**: 测试学生信息管理功能
- **测试项目**:
  - 创建学生信息
  - 获取所有学生列表
  - 搜索学生（按名称、用户名）
  - 按学院/专业/班级/状态获取学生列表
  - 获取/更新/删除特定学生信息

### 4. 教师信息服务测试
- **文件**: `test-teacher-info-service.ps1`
- **功能**: 测试教师信息管理功能
- **测试项目**:
  - 创建教师信息
  - 获取所有教师列表
  - 搜索教师（按名称、用户名）
  - 按部门/职称/状态获取教师列表
  - 获取活跃教师列表
  - 获取/更新/删除特定教师信息

### 5. 学分活动服务测试
- **文件**: `test-credit-activity-service.ps1`
- **功能**: 测试学分活动管理功能（合并了事务和申请管理）
- **测试项目**:
  - 获取活动类别
  - 创建/获取/更新/删除学分活动
  - 活动状态管理（提交、撤回、审核）
  - 参与者管理（添加、删除、设置学分）
  - 申请管理（创建、查看、统计）
  - 活动统计信息

### 6. 权限管理服务测试
- **文件**: `test-permission-service.ps1`
- **功能**: 测试权限管理功能
- **测试项目**:
  - 初始化权限系统
  - 创建/获取/更新/删除角色
  - 创建/获取/删除权限
  - 为用户分配/删除角色
  - 为角色分配/删除权限
  - 获取用户角色和权限列表

### 7. 综合测试
- **文件**: `test-all-services.ps1`
- **功能**: 测试所有服务的集成功能
- **测试项目**:
  - 完整的业务流程测试
  - 跨服务数据关联测试
  - 资源清理测试

## 使用方法

### 前置条件
1. 确保所有微服务都已启动并运行
2. 确保API网关服务运行在 `http://localhost:8080`
3. 确保PowerShell环境可用

### 运行单个服务测试
```powershell
# 测试认证服务
.\test-auth-service.ps1

# 测试用户管理服务
.\test-user-management-service.ps1

# 测试学生信息服务
.\test-student-info-service.ps1

# 测试教师信息服务
.\test-teacher-info-service.ps1

# 测试学分活动服务
.\test-credit-activity-service.ps1

# 测试权限管理服务
.\test-permission-service.ps1
```

### 运行综合测试
```powershell
# 运行所有服务的综合测试
.\test-all-services.ps1
```

### 自定义API网关地址
```powershell
# 如果API网关运行在其他地址，可以指定BaseUrl参数
.\test-auth-service.ps1 -BaseUrl "http://your-api-gateway:8080"
```

## 测试结果说明

每个测试脚本都会输出详细的测试结果：

- **[PASS]**: 测试通过（绿色显示）
- **[FAIL]**: 测试失败（红色显示）
- **[INFO]**: 测试信息（青色显示）

测试完成后会显示统计信息：
- 总测试数
- 通过数量
- 失败数量
- 最终结果（全部通过或有失败）

## 测试数据说明

- 所有测试脚本都会生成唯一的测试数据（使用时间戳）
- 测试完成后会自动清理创建的测试数据
- 测试数据不会影响生产环境

## 注意事项

1. **测试顺序**: 建议先运行单个服务测试，再运行综合测试
2. **网络连接**: 确保能够访问API网关服务
3. **服务状态**: 确保所有相关服务都正常运行
4. **权限问题**: 某些测试可能需要管理员权限
5. **数据清理**: 测试脚本会自动清理测试数据，但建议在测试前备份重要数据

## 故障排除

### 常见问题

1. **连接被拒绝**: 检查API网关服务是否启动
2. **认证失败**: 检查用户注册和登录流程
3. **权限不足**: 检查用户类型和权限设置
4. **数据不存在**: 检查相关服务是否正常运行

### 调试建议

1. 查看测试脚本的详细输出信息
2. 检查API网关的日志
3. 检查各个微服务的日志
4. 使用API文档验证接口是否正确

## 扩展测试

如需添加新的测试用例，可以参考现有脚本的结构：

1. 使用统一的测试函数（Pass、Fail、Info）
2. 遵循相同的错误处理模式
3. 确保测试数据的唯一性
4. 添加适当的资源清理逻辑 